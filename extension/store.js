const m={modelSwitcher:'[data-testid="model-switcher-dropdown-button"]',chatContainer:".flex.flex-col.text-sm",userMessage:'div[data-message-author-role="user"]',systemMessage:"div.text-token-text-secondary"};function g(e,t=1e4){return new Promise((n,o)=>{const r=document.querySelector(e);if(r)return n(r);const i=new MutationObserver(y=>{const h=document.querySelector(e);h&&(i.disconnect(),n(h))});i.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{i.disconnect(),o(new Error(`Element ${e} not found within ${t}ms`))},t)})}function C(){return new Promise(e=>{document.readyState==="complete"||document.readyState==="interactive"?e():document.addEventListener("DOMContentLoaded",()=>{e()})})}function w(e,t,n){const o=new MutationObserver(n);return o.observe(e,t),o}var d=(e=>(e.GPT4O="gpt-4o",e.GPT4="gpt-4",e.GPT35="gpt-3.5",e.GPT4_MINI="gpt-4-mini",e.GPT4_MINI_HIGH="gpt-4-mini-high",e.GPT4_5_PREVIEW="gpt-4.5-preview",e.GPT4O_MINI="gpt-4o-mini",e))(d||{});const v={"gpt-4o":{key:"gpt-4o",displayName:"GPT-4o",shortCode:"4o"},"gpt-4":{key:"gpt-4",displayName:"GPT-4",shortCode:"4"},"gpt-3.5":{key:"gpt-3.5",displayName:"GPT-3.5 (o3)",shortCode:"3.5"},"gpt-4-mini":{key:"gpt-4-mini",displayName:"GPT-4 Mini (o4-mini)",shortCode:"4m"},"gpt-4-mini-high":{key:"gpt-4-mini-high",displayName:"GPT-4 Mini High (o4-mini-high)",shortCode:"4mh"},"gpt-4.5-preview":{key:"gpt-4.5-preview",displayName:"GPT-4.5 Preview",shortCode:"4.5p"},"gpt-4o-mini":{key:"gpt-4o-mini",displayName:"GPT-4o Mini",shortCode:"4om"}};class M{constructor(){this.currentModel=null,this.listeners=[],this.observer=null}async initialize(){try{const t=await this.detectInitialModel();this.setCurrentModel(t),this.startWatchingModelChanges(),console.log(`ModelMeter: Initialized with model ${t||"unknown"}`)}catch(t){console.error("ModelMeter: Failed to initialize model detector",t)}}getCurrentModel(){return this.currentModel}onModelChange(t){return this.listeners.push(t),this.currentModel!==null&&t(this.currentModel),()=>{this.listeners=this.listeners.filter(n=>n!==t)}}async detectInitialModel(){var t;try{const o=(t=(await g(m.modelSwitcher)).textContent)==null?void 0:t.trim();return o?this.normalizeModelName(o):null}catch(n){return console.error("ModelMeter: Failed to detect initial model",n),null}}async startWatchingModelChanges(){try{const t=await g(m.modelSwitcher);this.observer=w(t,{childList:!0,subtree:!0,characterData:!0},()=>{var o;const n=(o=t.textContent)==null?void 0:o.trim();if(n){const r=this.normalizeModelName(n);this.setCurrentModel(r)}}),console.log("ModelMeter: Started watching for model changes")}catch(t){console.error("ModelMeter: Failed to watch model changes",t)}}setCurrentModel(t){if(t!==this.currentModel){const n=this.currentModel;this.currentModel=t,this.listeners.forEach(o=>o(t)),console.log(`ModelMeter: Model changed from ${n||"unknown"} to ${t||"unknown"}`)}}normalizeModelName(t){const n=t.toLowerCase().trim();return n.includes("gpt-4.5")&&n.includes("preview")?"gpt-4.5-preview":n.includes("gpt-4o mini")||n.includes("gpt-4o-mini")?"gpt-4o-mini":n.includes("gpt-4o")||n.includes("gpt-o4")||n.includes("gpt-4-o")?"gpt-4o":n.includes("o4-mini-high")?"gpt-4-mini-high":n.includes("o4-mini")?"gpt-4-mini":n.includes("gpt-4")||n.includes("gpt4")?"gpt-4":n.includes("o3")||n.includes("gpt-3.5")||n.includes("gpt3.5")||n.includes("gpt3")?"gpt-3.5":(console.warn(`ModelMeter: Unknown model display name: "${t}" (normalized: "${n}")`),null)}cleanup(){this.observer&&(this.observer.disconnect(),this.observer=null),this.listeners=[]}}const b=new M,u="modelMeterData";let c=[];function P(e){return c.push(e),()=>{c=c.filter(t=>t!==e)}}function s(e){c.forEach(t=>t(e))}function p(){return new Date().toISOString().split("T")[0]}function f(){return new Promise(e=>{chrome.storage.local.get([u],t=>{const n=t[u];e(n||null)})})}function a(e){return new Promise(t=>{chrome.storage.local.set({[u]:e},()=>t())})}async function l(){const e=p(),t=await f();if(!t||t.date!==e){const n=Object.values(d).reduce((r,i)=>(r[i]=0,r),{}),o={date:e,counts:n};return await a(o),s("all"),o}return t}async function G(e){return(await l()).counts[e]||0}async function D(e){const t=await l(),o=(t.counts[e]||0)+1;return t.counts[e]=o,await a(t),s(e),o}async function N(e,t){const n=await l();n.counts[e]=t,await a(n),s(e)}async function I(e){const t=await l();t.counts[e]=0,await a(t),s(e)}async function S(){const e=p(),t=Object.values(d).reduce((o,r)=>(o[r]=0,o),{});await a({date:e,counts:t}),s("all")}export{d as M,P as a,v as b,N as c,C as d,S as e,G as g,D as i,b as m,I as r,m as s,g as w};
